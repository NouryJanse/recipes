---
import Layout from "../../layouts/Layout.astro";
import verifyJWT from "../../services/verifyjwt";

const jwtCookie = Astro.cookies.get("jwt");
const jwt = jwtCookie?.value ? jwtCookie.value : "";
const user = verifyJWT(jwt);

if (user) {
  return Astro.redirect("/");
}
---

<Layout title="Login">
  <div class="container">
    <h1>Sign in</h1>

    <form action="/api/user/login" method="post">
      <section>
        <label for="username">
          <span>Username</span>
          <input id="username" name="username" type="text" autocomplete="username" required autofocus value="alice" />
        </label>
      </section>

      <section>
        <label for="current-password">
          <span>Password</span>
          <input
            id="current-password"
            name="password"
            type="password"
            autocomplete="current-password"
            required
            value="wonderland"
          />
        </label>
      </section>
      <button class="">
        <a href="/user/register">Register</a>
      </button>

      <button type="submit" class="blue">Sign in</button>
    </form>
  </div>
</Layout>
